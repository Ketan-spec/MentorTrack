<!DOCTYPE html>
<html lang="en">
<head>
    <title>MentorTrack — Mentee Dashboard</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="{{ url_for('static', filename='css/mentee.css') }}" rel="stylesheet" />
</head>

<body class="body-root">
    <header class="navbar-wrapper">
        <div class="navbar-container">
            <a href="{{ url_for('index') }}" class="brand-link">
                <div class="brand-logo">
                    <span class="brand-initials">MT</span>
                </div>
                <div class="brand-text">
                    <span class="brand-name">MentorTrack</span>
                    <span class="brand-subtitle">Mentee Dashboard</span>
                </div>
            </a>
            <div class="navbar-actions">
                <button type="button" id="sidebarToggle-2" class="sidebar-toggle-button">
                    <img src="https://api.iconify.design/lucide-menu.svg?color=%230f172a" alt="Menu" class="menu-icon" />
                    <span class="menu-label">Menu</span>
                </button>
                <a href="{{ url_for('logout') }}" class="profile-button">
                    <img src="https://api.iconify.design/lucide-log-out.svg?color=%230f172a" alt="Logout" class="user-icon" />
                    <span class="profile-label">Logout</span>
                </a>
            </div>
        </div>
    </header>

    <div class="layout-wrapper">
        <aside id="sidebar-2" class="sidebar">
            <div class="sidebar-header">
                <span class="sidebar-title">Navigation</span>
            </div>
            <nav class="sidebar-nav">
                <a href="{{ url_for('mentee_dashboard') }}" class="sidebar-link-dashboard">
                    <img src="https://api.iconify.design/lucide-home.svg?color=%230f172a" alt="" class="sidebar-icon-dashboard" />
                    <span class="sidebar-label-dashboard">Dashboard</span>
                </a>
                <a href="{{ url_for('mentee_dashboard') }}" class="sidebar-link-tasks">
                    <img src="https://api.iconify.design/lucide-list-checks.svg?color=%230f172a" alt="" class="sidebar-icon-tasks" />
                    <span class="sidebar-label-tasks">My Tasks</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <a href="{{ url_for('logout') }}" class="logout-link">Log out</a>
            </div>
        </aside>

        <main class="main-content">
            <!-- My Mentor Card -->
            <section class="top-grid">
                <div class="my-mentor-card">
                    <div class="card-header">
                        <div class="card-title-group">
                            <div class="avatar-wrapper">
                                {% if mentor %}
                                <img src="https://ui-avatars.com/api/?name={{ mentor.full_name }}&background=14b8a6&color=fff" alt="Mentor" class="mentor-avatar" />
                                {% else %}
                                <img src="https://ui-avatars.com/api/?name=No+Mentor&background=94a3b8&color=fff" alt="No Mentor" class="mentor-avatar" />
                                {% endif %}
                            </div>
                            <div class="mentor-info">
                                <span class="mentor-name">{{ mentor.full_name if mentor else "Not assigned" }}</span>
                                <span class="mentor-domain">{{ mentor.domain if mentor else "No mentor assigned yet" }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="progress-label-row">
                            <span class="progress-label">Learning Progress</span>
                            <span class="progress-percent">{{ mentor.progress if mentor else 0 }}%</span>
                        </div>
                        <div class="progress-bar-wrapper">
                            <div class="progress-bar-fill" style="width:{{ mentor.progress if mentor else 0 }}%"></div>
                        </div>
                        <div class="progress-details">
                            <span class="progress-detail-completed">
                                <span class="detail-dot"></span>
                                Keep working hard!
                            </span>
                        </div>
                    </div>
                </div>

                <div class="actions-card">
                    <div class="actions-header">
                        <span class="actions-title">Quick Actions</span>
                    </div>
                    <div class="actions-body">
                        <button type="button" class="request-new-task-button" onclick="alert('Contact your mentor to request a new task!')">
                            <img src="https://api.iconify.design/lucide-list-checks.svg?color=%23ffffff" alt="" class="new-task-icon" />
                            Request New Task
                        </button>
                        <div class="actions-hint">
                            Your mentor will be notified automatically.
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tasks Section -->
            <section class="tasks-section">
                <div class="tasks-header">
                    <span class="tasks-title">My Tasks</span>
                </div>
                <div class="tasks-table-wrapper">
                    <table class="tasks-table">
                        <thead class="table-head">
                            <tr class="table-head-row">
                                <th class="table-head-cell">Task</th>
                                <th class="table-head-cell">Deadline</th>
                                <th class="table-head-cell">Status</th>
                                <th class="table-head-cell">Action</th>
                            </tr>
                        </thead>
                        <tbody class="table-body">
                            {% if tasks %}
                                {% for task in tasks %}
                                <tr>
                                    <td class="task-cell">
                                        {{ task.title }}
                                        <div class="task-meta">{{ task.description }}</div>
                                    </td>
                                    <td class="deadline-cell">{{ task.deadline }}</td>
                                    <td class="status-cell">
                                        <span class="status-badge">{{ task.status }}</span>
                                    </td>
                                    <td class="status-cell">
                                        {% if task.status == 'assigned' %}
                                        <button class="request-task-change-button" onclick="updateTaskStatus({{ task.id }}, 'in_progress')">
                                            Start Task
                                        </button>
                                        {% elif task.status == 'in_progress' %}
                                        <button class="request-new-task-button" onclick="updateTaskStatus({{ task.id }}, 'completed')">
                                            Complete
                                        </button>
                                        {% else %}
                                        <span style="color:#10b981;">✓ Done</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="4" class="no-tasks" style="text-align:center; padding:2rem; color:#64748b;">
                                        No tasks assigned yet.
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Schedule Section -->
            <section id="schedule" class="schedule-section">
                <div class="schedule-header">
                    <span class="schedule-title">Upcoming Sessions</span>
                </div>
                <div class="schedule-content">
                    <div class="upcoming-session-card">
                        <div class="session-list-header">
                            <img src="https://api.iconify.design/lucide-calendar.svg?color=%230f172a" alt="" class="calendar-icon" />
                            <span class="session-list-title">Scheduled Meetings</span>
                        </div>
                        <ul class="session-list">
                            {% if sessions %}
                                {% for session in sessions %}
                                <li class="session-item">
                                    <div class="session-info">
                                        <span class="session-title">{{ session.title }}</span>
                                        <span class="session-meta">{{ session.session_date }} • {{ session.duration }} min</span>
                                    </div>
                                    {% if session.meeting_link %}
                                    <a href="{{ session.meeting_link }}" target="_blank" class="session-join-button">Join</a>
                                    {% endif %}
                                </li>
                                {% endfor %}
                            {% else %}
                                <li class="no-sessions" style="text-align:center; padding:2rem; color:#64748b;">
                                    No upcoming sessions.
                                </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <footer class="footer-wrapper">
        <div class="footer-container">
            <p>© MentorTrack 2025</p>
        </div>
    </footer>

    <script>
        // Sidebar Toggle
        const sidebar = document.getElementById('sidebar-2');
        const sidebarToggle = document.getElementById('sidebarToggle-2');
        
        sidebarToggle?.addEventListener('click', () => {
            sidebar.style.display = sidebar.style.display === 'none' ? 'block' : 'none';
        });

        // Update Task Status
        async function updateTaskStatus(taskId, newStatus) {
            try {
                const response = await fetch(`/api/tasks/${taskId}/update-status`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: newStatus })
                });

                const result = await response.json();
                
                if (result.success) {
                    alert('Task status updated!');
                    location.reload();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error updating task: ' + error);
            }
        }
    </script>
</body>
</html>